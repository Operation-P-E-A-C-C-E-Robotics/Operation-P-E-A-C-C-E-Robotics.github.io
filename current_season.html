---
layout: default
title: Stats - FRC 3461
---
<br>
<div class="container-fluid">
  <!-- Here a loader is created which 
          loads till response comes -->
  <div class="d-flex justify-content-center">
      <div class="spinner-border" 
              role="status" id="loading">
          <span class="sr-only">Loading...</span>
      </div>
  </div>
  <h1 id="header" class="text-center">Loading...</h1>
  <!-- <h1 id="loading">Loading...</h1> -->
  <!-- table for showing data -->
  <br>
  <flex style="flex-flow: row wrap;">
    <div id="duringEventBanner" style="display:none;" class="jumbotron text-dark">
      <h1 id="currentCompetingEvent" class="text-center">
        Currently Competing At () Event!
      </h1>
      <div style="display:flex; flex-direction:row; justify-content:space-around;">
      <h3 id="currentNextMatch" style="text-transform: uppercase;">
        Next Match: Not Found
      </h3>
      <h3>
        <p id='counter'>--h --m --s</p>
      </h3>
      <h3 id="redTeams">
        0000 0000 0000 
      </h3>
      <h3>
      VS
      </h3>
      <h3 id="blueTeams">
        0000 0000 0000
      </h3>
      <h3 id='time'></h3>
      </div>
      <h4 id="currentRank">
      Rank: 0/0
      </h4>

      <!-- <p id="liveStream">
      Event Webcast: Not Found
      </p> -->
   
    </div>
    <div id="demo" class="carousel slide" data-ride="carousel" style="width:20%; background-color: white; border-radius: 5px;">
      <!-- The slideshow -->
      <div class="carousel-item" id="robotImagePlaceholder" style="height: 500px;">
          <img  src="/assets/images/notFound.png" class="img-rounded" style="width: 100%; height:max-content; position:relative">
      </div>
      <div class="carousel-inner" id="robotCarousel">
      </div>
    </div> 
    <br>
  </flex>
<br>
  <div class="table-responsive">
    <table id="employees" class="table"></table>
  </div> 
</div>

<script>
  var events = "https://www.thebluealliance.com/api/v3/team/frc3461/events/";
       var year = new Date().getFullYear();
       var eventstatuses = "/statuses?X-TBA-Auth-Key=hOngAA1OYRpYtrfePLodT2G27R7fSBfrGJ57RwH1sOZJxaJv3rHGfhH37aLitVNb"
       const authKey = "?X-TBA-Auth-Key=hOngAA1OYRpYtrfePLodT2G27R7fSBfrGJ57RwH1sOZJxaJv3rHGfhH37aLitVNb"
 
       var media = "https://www.thebluealliance.com/api/v3/team/frc3461/media/"
       var awards = "https://www.thebluealliance.com/api/v3/team/frc3461/awards/"
 
 
       var eventstats = events + year + eventstatuses;
       var eventurl = events + year + authKey;
       var mediaurl = media + year + authKey;
       var awardsurl = awards + year + authKey;
       var countDownDate;
 
       function json2array(json) {
         var result = [];
         for (var i in json) {
           result.push([i, json[i]]);
         }
         return result;
       }
       // Defining async function
 
 
       async function getMedia(mediaURL) {
         const apiResponse = await fetch(mediaURL);
         const mediaJSON = await apiResponse.json();
         //console.log(mediaJSON);
         var hasPlacedImage = false;
         for (var i = 0; i < mediaJSON.length; i++) {
           const tempMedia = mediaJSON[i];
           //console.log(mediaJSON[i]);
           if (mediaJSON[i].preferred == true && mediaJSON[i].direct_url != undefined) {
 
             if (hasPlacedImage == false) {
               document.getElementById("robotCarousel").innerHTML += `<div class="carousel-item active img-thumbnail" style="width:100%; height:500px; background-size: 100% 100%; background-repeat: no-repeat; background-image:url('${mediaJSON[i].direct_url}');"></div>`;
               hasPlacedImage = true;
             } else {
               document.getElementById("robotCarousel").innerHTML += `<div class="carousel-item img-thumbnail" style="width:100%; height:500px; background-size: 100% 100%; background-repeat: no-repeat; background-image:url('${mediaJSON[i].direct_url}');"></div>`;
             }
 
 
           }
         }
 
         if (mediaJSON.length == 0) {
           document.getElementById("robotImagePlaceholder").classList.add("active");
         }
 
       }
 
       async function getapi(eventurl, eventstats, awards) {
         const eventResponse = await fetch(eventurl);
         const eventStats = await fetch(eventstats);
         const awardsData = await fetch(awards);
         // Storing data in form of JSON
         var eventdata = await eventResponse.json();
         // var eventdata = JSON.parse(eventdatatemp);
         var eventstatdata = await eventStats.json();
         var awardsForYear = await awardsData.json();
         /* console.log("Event Data")
          console.log(eventdata);
          console.log("Event Stats")
          console.log(eventstatdata); */
 
         if (eventstatdata && eventdata) {
           hideloader();
         }
         show(eventstatdata, eventdata, awardsForYear);
 
         document.getElementById("header").innerHTML = year + " Competition Season"
         getMedia(mediaurl);
       }
       // Calling that async function
       getapi(eventurl, eventstats, awardsurl);
       setBanner(eventurl)
       async function setBanner(eventsurl) {
         var eventJSON = await fetch(eventsurl);
         var events = await eventJSON.json();
         var curevents = []
         var currentEvent;
         //console.log(events);
         for (let key of Object.entries(events)) {

           //console.log(key);
           var date = new Date()
           var eventStartDate = new Date(key[1].start_date);
           var eventEndDate = new Date(key[1].end_date);
           //console.log(dateConfig);
           //console.log(eventStartDate);
           if (date.getTime() <= eventEndDate.getTime() && date.getTime() >= eventStartDate.getTime()) {
             curevents.push(key[1]);
             currentEvent = key[1];
           }
         }
 
        //  console.log(curevents);
        //  if (curevents.length > 1) {
        //    console.log(curevents);
        //    //error handling for when competing at DCMP or CMP where we are listed in the parent event and the division event at the same time
        //    var parentEvent = {};
        //    var divisionEvent = {};
        //    //establish which event is a division and which one is the parent
        //    for (var i = 0; i < curevents.length; i++) {
        //      if (curevents[i].parent_event_key == null) {
        //        parentEvent = curevents[i];
        //      } else {
        //        divisionEvent = curevents[i];
        //      }
        //    }
        //    var parentEventDataURL = "https://www.thebluealliance.com/api/v3/team/frc3461/event/" + year + parentEventJSON.event_code + "/status" + authKey
        //    var parentEventAPIResponse = await fetch(parentEventDataURL);
        //    //console.log(parentEventAPIResponse);
        //    var parentEventJSON = await parentEventAPIResponse.json();
        //    var divisionEventDataURL = "https://www.thebluealliance.com/api/v3/team/frc3461/event/" + year + divisionEventJSON.event_code + "/status" + authKey
        //    var divisionEventAPIResponse = await fetch(divisionEventDataURL);
        //    var divisionEventJSON = await divisionEventAPIResponse.json();
 
        //                 console.log("parent");
        //                console.log(parentEventJSON);
                       
        //                console.log("division");
        //                console.log(divisionEventJSON);
 
        //    if (divisionEvent.status == "won") { //if we have data in the Parent event, then we must have advanced out of the division           
        //      var nextMatchData = await getMatchFromKey(nextMatchKey.next_match_key);
        //      console.log("Next Match Data")
        //      console.log(nextMatchData);
            //  bannerHelper(parentEvent.name, nextMatchData);
 
          //  } else { //otherwise we are still in the division
            //  var nextMatchKey = getTeamStatus(divisionEventJSON.event_code);
            //  var nextMatchData = await getMatchFromKey(nextMatchKey);
            //  console.log(nextMatchData);
            //  bannerHelper(divisionEvent.name, nextMatchData);
           //}
        //  } else {
                   //console.log(eventKey);
         var matchAPIURL = "https://www.thebluealliance.com/api/v3/team/frc3461/event/" + year + curevents[0].event_code + "/status" + authKey;
         var matchAPIResponse = await fetch(matchAPIURL);
         var match = await matchAPIResponse.json();
           
         //let nextMatchData = await getMatchFromKey(nextMatchKey);
           //console.log(nextMatchKey);
           console.log(match);
          bannerHelper(curevents[0].name, match.next_match_key, match);
           //only playing at one event (district most likely)
           //document.getElementById("currentCompetingEvent").innerHTML = "Currently Competing At " + curevents[0].name
           //bannerHelper(curevents[0].name, )
 //        }
 
      }
 
       async function getMatchFromKey(matchKey) {
         var matchAPIURL = "https://www.thebluealliance.com/api/v3/match/" + matchKey + authKey;
         var matchAPIResponse = await fetch(matchAPIURL);
         var match = await matchAPIResponse.json();
         console.log(match);
         return Promise.resolve(match);
       }
 
       async function getTeamStatus(eventKey) {
         //console.log(eventKey);
         var matchAPIURL = "https://www.thebluealliance.com/api/v3/team/frc3461/event/" + year + eventKey + "/status" + authKey;
         var matchAPIResponse = await fetch(matchAPIURL);
         var match = await matchAPIResponse.json();
         return match;
       }
 
       async function bannerHelper(eventTitle, nextMatch, stats) {
         //console.log(nextMatch);
         var match = await getMatchFromKey(nextMatch);
         console.log(nextMatch);
         countDownDate = match.predicted_time
         document.getElementById("currentCompetingEvent").innerHTML = "Currently Competing At " + eventTitle;
         document.getElementById("currentNextMatch").innerHTML = "Next Match: " + match.comp_level + " " + match.match_number;
         document.getElementById("redTeams").innerHTML = clearFRCfromTeam(match.alliances.red.team_keys[0]) + " " + clearFRCfromTeam(match.alliances.red.team_keys[1]) + " " + clearFRCfromTeam(match.alliances.red.team_keys[2])
         document.getElementById("blueTeams").innerHTML = clearFRCfromTeam(match.alliances.blue.team_keys[0]) + " " + clearFRCfromTeam(match.alliances.blue.team_keys[1]) + " " + clearFRCfromTeam(match.alliances.blue.team_keys[2])
         document.getElementById("currentRank").innerHTML = "Rank: " + stats.qual.ranking.rank + "/" + stats.qual.num_teams
         document.getElementById("duringEventBanner").style.display = "block";
       }
 
       function clearFRCfromTeam(team) {
         myString = team.replace(/\D/g, '');
         return myString;
       }
 
 
       // Function to hide the loader
       function hideloader() {
         document.getElementById('loading').style.display = 'none';
       }
 
       // Function to define innerHTML for HTML table
       function show(event, stats, awards) {
         /*       console.log("event info");
                 console.log(event);
                 console.log("match info");
                 console.log(stats); */
         let tab =
           `<tr>
             <th>Event Name</th>
             <th>Ranking</th>
             <th>Awards</th>
         </tr>`;
 
         var result = json2array(event);
         var statResult = json2array(stats);
 
         length = result.length;
         //console.log(result);
         labels = [];
         values = [];
         for (i = 0; i < length; i++) {
           labels.push(result[i]);
         }
 
         if (length == 0) {
           tab = `<h1 class=text-center>No Events Found</h1>`
           document.getElementById("employees").innerHTML = tab;
         }
 
         //console.log(labels);
         //console.log(awards)
         for (var label in labels) {
           if (labels[label][1] != null) {
             tab += `<tr><td id=${stats[label].key}>${stats[label].name}</td><td>${labels[label][1].overall_status_str}</td><td id=${stats[label].key + "awards"}>None Found</td></tr>`;
           } else {
             tab += `<tr><td id=${stats[label].key}>${stats[label].name}</td><td>No Data</td><td>No Data</td></tr>`
           }
           // Setting innerHTML as tab variable
           document.getElementById("employees").innerHTML = tab;
         }
 
         //console.log(awards);
         for (var i = 0; i < awards.length; i++) {
           //console.log(awards[i]);
           document.getElementById(awards[i].event_key + "awards").innerHTML = awards[i].name;
         }
 
       }
 
       function convertTime(date) {
                return new Date((typeof date === "string" ? new Date(date):date).toLocaleString('en-US', {timeZone: 'America/New_York'}))
        }

        function convertTimestamp(timestamp) {
        var d = new Date(timestamp * 1000), // Convert the passed timestamp to milliseconds
        yyyy = d.getFullYear(),
        mm = ('0' + (d.getMonth() + 1)).slice(-2),  // Months are zero based. Add leading 0.
        dd = ('0' + d.getDate()).slice(-2),         // Add leading 0.
        hh = d.getHours(),
        h = hh,
        min = ('0' + d.getMinutes()).slice(-2),     // Add leading 0.
        ampm = 'AM',
        time;

        if (hh > 12) {
        h = hh - 12;
        ampm = 'PM';
       } else if (hh === 12) {
        h = 12;
        ampm = 'PM';
       } else if (hh == 0) {
        h = 12;
      }

        // ie: 2014-03-24, 3:00 PM
        time = yyyy + '-' + mm + '-' + dd + ', ' + h + ':' + min + ' ' + ampm;
        return time;
}

       var x = setInterval(function() {
         var now = convertTime(new Date()).getTime();
         var d = new Date().toLocaleTimeString();
         var distance = new Date(convertTimestamp(countDownDate)).getTime() - now; 
         var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
         var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
         var seconds = Math.floor((distance % (1000 * 60)) / 1000);
 
         //   document.getElementById("counter").innerHTML = d + " | ";
         document.getElementById("counter").innerHTML = "~" + hours + "h " + minutes + "m " + seconds + "s ";
         document.getElementById("time").innerHTML = d;
 
         if (hours == 0 && minutes < 20) {
           document.getElementById("counter").classList.add("yellowwarning");
           // document.getElementById("counter").innerHTML =  d + " | ";
           document.getElementById("counter").innerHTML = "~" + hours + "h " + minutes + "m " + seconds + "s DOUBLE QUENE";
         }
         if (hours == 0 && minutes < 10) {
           document.getElementById("counter").classList.remove("yellowwarning");
           document.getElementById("counter").classList.add("redalliance");
           // document.getElementById("counter").innerHTML = d + " | ";
           document.getElementById("counter").innerHTML = "~" + hours + "h " + minutes + "m " + seconds + "s QUENE";
         }
 
         if (minutes < -4) {
           setBanner(eventurl);
         }
 
         if (minutes > 0 && seconds == 0) {
           setBanner(eventurl);
         }
 
       }, 1000);
 
 </script>

<style>
  table {
    width: 75%;
    align-self: center;
  }

  #redTeams {
    color: red;
  }

  #blueTeams {
    color:blue;
  }

</style>

