---
layout: default
title: Stats - FRC 3461
---
<br>
<div class="container-fluid">
  <!-- Here a loader is created which 
          loads till response comes -->
  <div class="d-flex justify-content-center">
      <div class="spinner-border" 
              role="status" id="loading">
          <span class="sr-only">Loading...</span>
      </div>
  </div>
  <h1 id="header" class="text-center">Loading...</h1>
  <!-- <h1 id="loading">Loading...</h1> -->
  <!-- table for showing data -->
  <br>
  <flex style="flex-flow: row wrap;">
    <div id="demo" class="carousel slide" data-ride="carousel" style="width:20%; background-color: white; border-radius: 5px;">
      <!-- The slideshow -->
      <div class="carousel-item" id="robotImagePlaceholder" style="height: 500px;">
          <img  src="/assets/images/notFound.png" class="img-rounded" style="width: 100%; height:max-content; position:relative">
      </div>
      <div class="carousel-inner" id="robotCarousel">
      </div>
    </div> 
    <br>
    <div id="duringEventBanner" style="display:none;" class="jumbotron text-dark">
      <h1 id="currentCompetingEvent">
        Currently Competing At () Event!
      </h1>
      <div style="display:flex; flex-direction:row; justify-content:space-around;">
      <h3 id="currentNextMatch">
        Next Match: Not Found
      </h3>
      <h3>
        <p id='counter'>--h --m --s</p>
      </h3>
      </div>
      <h4 id="currentRank">
      Rank: 0/0
      </h4>
      <p id="liveStream">
      Event Webcast: Not Found
      </p>
   
  </div>
  </flex>
<br>
  <div class="table-responsive">
    <table id="employees" class="table"></table>
  </div> 
</div>

<script>
       var events = "https://www.thebluealliance.com/api/v3/team/frc3461/events/";
      var year = new Date().getFullYear();
      var eventstatuses = "/statuses?X-TBA-Auth-Key=hOngAA1OYRpYtrfePLodT2G27R7fSBfrGJ57RwH1sOZJxaJv3rHGfhH37aLitVNb"
      const authKey = "?X-TBA-Auth-Key=hOngAA1OYRpYtrfePLodT2G27R7fSBfrGJ57RwH1sOZJxaJv3rHGfhH37aLitVNb"

      var media = "https://www.thebluealliance.com/api/v3/team/frc3461/media/"
      var awards = "https://www.thebluealliance.com/api/v3/team/frc3461/awards/"


      var eventstats = events + year + eventstatuses;
      var eventurl = events + year + authKey;
      var mediaurl = media + year + authKey;
      var awardsurl = awards + year + authKey;
      var countDownDate;

      function json2array(json) {
        var result = [];
        for (var i in json) {
          result.push([i, json[i]]);
        }
        return result;
      }
      // Defining async function


      async function getMedia(mediaURL) {
        const apiResponse = await fetch(mediaURL);
        const mediaJSON = await apiResponse.json();
        //console.log(mediaJSON);
        var hasPlacedImage = false;
        for (var i = 0; i < mediaJSON.length; i++) {
          const tempMedia = mediaJSON[i];
          //console.log(mediaJSON[i]);
          if (mediaJSON[i].preferred == true && mediaJSON[i].direct_url != undefined) {
            
            if (hasPlacedImage == false) {
              document.getElementById("robotCarousel").innerHTML += `<div class="carousel-item active img-thumbnail" style="width:100%; height:500px; background-size: 100% 100%; background-repeat: no-repeat; background-image:url('${mediaJSON[i].direct_url}');"></div>`;
              hasPlacedImage = true;
            } else {
              document.getElementById("robotCarousel").innerHTML += `<div class="carousel-item img-thumbnail" style="width:100%; height:500px; background-size: 100% 100%; background-repeat: no-repeat; background-image:url('${mediaJSON[i].direct_url}');"></div>`;
            }


          }
        }

        if (mediaJSON.length == 0) {
          document.getElementById("robotImagePlaceholder").classList.add("active");
        }

      }

      async function getapi(eventurl, eventstats, awards) {
        const eventResponse = await fetch(eventurl);
        const eventStats = await fetch(eventstats);
        const awardsData = await fetch(awards);
        // Storing data in form of JSON
        var eventdata = await eventResponse.json();
        // var eventdata = JSON.parse(eventdatatemp);
        var eventstatdata = await eventStats.json();
        var awardsForYear = await awardsData.json();
           /* console.log("Event Data")
            console.log(eventdata);
            console.log("Event Stats")
            console.log(eventstatdata); */

        if (eventstatdata && eventdata) {
          hideloader();
        }
        show(eventstatdata, eventdata, awardsForYear);
        
        document.getElementById("header").innerHTML = year + " Competition Season"
        getMedia(mediaurl);
      }
      // Calling that async function
      getapi(eventurl, eventstats, awardsurl);
      setBanner(eventurl);
      async function setBanner(eventsurl) {
        var eventJSON = await fetch(eventsurl);
        var events = await eventJSON.json();
        var curevents = []
        for (var i = 0; i < events.length; i++) {
          //nsole.log(events[i]);
        		var dateConfig = { year: 'numeric', month: 'numeric', day: 'numeric', timezone: events[i].timezone};
            var date = new Date()
            var eventStartDate = new Date(events[i].start_date);
            var eventEndDate = new Date(events[i].end_date);
            //console.log(dateConfig);
            //console.log(eventStartDate);
            if (date.getTime() <= eventEndDate.getTime() && date.getTime() >= eventStartDate.getTime()) {
            	curevents.push(events[i]);
              //console.log(events[i]);
              //console.log(curevents);
              var currentEvent = events[i];              
            }
        }
        
        if (curevents.length > 1) {
        	//error handling for when competing at DCMP or CMP where we are listed in the parent event and the division event at the same time
          var parentEvent = {};
          var divisionEvent = {};
          //establish which event is a division and which one is the parent
          for (var i = 0; i < curevents.length; i++) {
          	if (curevents[i].parent_event_key == null) {
            	parentEvent = curevents[i];
            } else  {
            divisionEvent = curevents[i];
            } 
          }
            //console.log(parentEvent);
            //console.log(divisionEvent);
            //get data from the 2 events now, have we advanced yet?
            var parentEventDataURL = "https://www.thebluealliance.com/api/v3/team/frc3461/event/" + year + parentEvent.event_code + "/status" + authKey
            var parentEventAPIResponse = await fetch(parentEventDataURL);
        		console.log(parentEventAPIResponse);
            var parentEventJSON = await parentEventAPIResponse.json();
            
            var divisionEventDataURL = "https://www.thebluealliance.com/api/v3/team/frc3461/event/" + year + divisionEvent.event_code + "/status" + authKey
            //console.log(divisionEventDataURL);
            var divisionEventAPIResponse = await fetch(divisionEventDataURL);
        		
            var divisionEventJSON = await divisionEventAPIResponse.json();

            
            
            console.log("parent");
            console.log(parentEventJSON);
            
            console.log("division");
            console.log(divisionEventJSON);
            
            if (parentEventJSON != undefined) { //if we have data in the Parent event, then we must have advanced out of the division
            		document.getElementById("currentCompetingEvent").innerHTML = "Currently Competing At " + parentEvent.name
                 if (parentEvent.next_match_key != undefined){
                  var matchAPI = "https://www.thebluealliance.com/api/v3/match/" + parentEvent.next_match_key + authKey
                  var matchRespone = await fetch(matchAPI);
                  var match = matchRespone.json();
                  document.getElementById("currentNextMatch").innerHTML = match.comp_level + match.match_number
           }
								document.getElementById("duringEventBanner").style.display = "block";
            } else {
            document.getElementById("currentCompetingEvent").innerHTML = "Currently Competing At " + divisionEvent.name
      		   if (divisionEvent.next_match_key != undefined){
                  var teamStatusAPI = "https://www.thebluealliance.com/api/v3/team/frc3461/event/" + year + divisionEvent.event_key + authKey;
                  var matchAPI = "https://www.thebluealliance.com/api/v3/match/" + divisionEvent.next_match_key + authKey
                  var matchRespone = await fetch(matchAPI);
                  var teamStatusResponse = await fetch(teamStatusAPI);
                  var match = matchRespone.json();
                  var team = teamStatusAPI.json();
                  if (matchRespone.predicted_time != undefined) {
                  countDownDate == new Date(matchRespone.predicted_time).getTime();
                  } else {
                    countDownDate == new Date().getTime();
                  }
                  document.getElementById("currentNextMatch").innerHTML = match.comp_level + match.match_number

                if (team != undefined) { 
                document.getElementById("currentRank").innerHTML = "Rank:" + team.qual.ranking.rank + "/" + team.qual.num_teams;
                  
              }
           }


              document.getElementById("duringEventBanner").style.display = "block";
            }
            
            
            
        } else {
            document.getElementById("currentCompetingEvent").innerHTML = "Currently Competing At " + curevents[0].name
      		   if (curevents.next_match_key != null){
                  var matchAPI = "https://www.thebluealliance.com/api/v3/match/" + curevents.next_match_key + authKey
                  var matchRespone = await fetch(matchAPI);
                  var match = matchRespone.json();
                  
                  document.getElementById("currentNextMatch").innerHTML = match.comp_level + match.match_number
           }
						document.getElementById("duringEventBanner").style.display = "block";
        }
        
      }

      // Function to hide the loader
      function hideloader() {
        document.getElementById('loading').style.display = 'none';
      }

      // Function to define innerHTML for HTML table
      function show(event, stats, awards) {
        /*       console.log("event info");
                console.log(event);
                console.log("match info");
                console.log(stats); */
        let tab =
          `<tr>
            <th>Event Name</th>
            <th>Ranking</th>
            <th>Awards</th>
        </tr>`;

        var result = json2array(event);
        var statResult = json2array(stats);

        length = result.length;
        //console.log(result);
        labels = [];
        values = [];
        for (i = 0; i < length; i++) {
          labels.push(result[i]);
        }
      
        if (length == 0) {
          	tab = `<h1 class=text-center>No Events Found</h1>`
            document.getElementById("employees").innerHTML = tab;
        }

        console.log(labels);
        //console.log(awards)
        for (var label in labels) {
          if (labels[label][1] != null) {
            tab += `<tr><td id=${stats[label].key}>${stats[label].name}</td><td>${labels[label][1].overall_status_str}</td><td id=${stats[label].key + "awards"}>None Found</td></tr>`;
          } else {
            tab += `<tr><td id=${stats[label].key}>${stats[label].name}</td><td>No Data</td><td>No Data</td></tr>`
          }
          // Setting innerHTML as tab variable
          document.getElementById("employees").innerHTML = tab;
        }

        //console.log(awards);
        for (var i = 0; i < awards.length; i++ ) {
          //console.log(awards[i]);
          document.getElementById(awards[i].event_key+"awards").innerHTML = awards[i].name;
        }

      }

      var x = setInterval(function() {
			var now = new Date().getTime();
      var d = new Date().toLocaleTimeString();
      var distance = countDownDate - now;
			var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
			var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
			var seconds = Math.floor((distance % (1000 * 60)) / 1000);

			//   document.getElementById("counter").innerHTML = d + " | ";
              document.getElementById("counter").innerHTML = hours + "h " + minutes + "m " + seconds + "s ";
              document.getElementById("time").innerHTML = d;
              
              if (hours == 0 && minutes < 20) {
                document.getElementById("counter").classList.add("yellowwarning");
                // document.getElementById("counter").innerHTML =  d + " | ";
                document.getElementById("counter").innerHTML = hours + "h " + minutes + "m " + seconds + "s DOUBLE QUENE";
              } 
              if (hours == 0 && minutes < 10) {
                document.getElementById("counter").classList.remove("yellowwarning");
                document.getElementById("counter").classList.add("redalliance");
                // document.getElementById("counter").innerHTML = d + " | ";
                document.getElementById("counter").innerHTML = hours + "h " + minutes + "m " + seconds + "s QUENE";
              }

              if (minutes < -4) {
                setBanner(eventurl);
              }

              if (minutes > 0 && seconds == 0) {
                setBanner(eventurl);
              }

			}, 1000);
</script>

<style>
  table {
    width: 75%;
    align-self: center;
  }

</style>

